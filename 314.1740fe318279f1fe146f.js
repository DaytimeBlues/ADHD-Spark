(self.webpackChunkspark_adhd_rn=self.webpackChunkspark_adhd_rn||[]).push([[314],{47864(e,t,n){var r=n(18772);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,o,a,i=r(n(16578)),l=r(n(26007)),u=r(n(51750)),c=r(n(66593)),f=r(n(82857)),m=n(8747),d=(0,f.default)(function e(){(0,c.default)(this,e),this.messages=[],this.handlers=[],this.systemPrompt="\n    You are Spark, an AI assistant for Spark ADHD. \n    You are helpful, concise, and understand ADHD challenges (executive dysfunction, overwhelm).\n    Encourage the user to use Spark's tools like Fog Cutter or Ignite.\n    If the user seems overwhelmed, suggest a 5-minute task.\n  ",this.messages=[{id:"initial",role:"system",content:this.systemPrompt,timestamp:Date.now()}]},[{key:"subscribe",value:function(e){var t=this;return this.handlers.push(e),e((0,u.default)(this.messages)),function(){t.handlers=t.handlers.filter(function(t){return t!==e})}}},{key:"getMessages",value:function(){return(0,u.default)(this.messages)}},{key:"sendMessage",value:(a=(0,l.default)(i.default.mark(function e(t){var n,r,s;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n={id:Math.random().toString(36).substring(7),role:"user",content:t,timestamp:Date.now()},this.messages.push(n),this.notify(),r={id:Math.random().toString(36).substring(7),role:"assistant",content:"",timestamp:Date.now()},this.messages.push(r),this.notify(),e.prev=1,"kimi-direct"!==m.config.aiProvider){e.next=3;break}return e.next=2,this.callKimiDirect(r);case 2:e.next=4;break;case 3:return e.next=4,this.callVercelBackend(r);case 4:e.next=6;break;case 5:e.prev=5,s=e.catch(1),console.error("Chat failed",s),r.content="Unable to reach AI service. Check your connection.",this.notify();case 6:case"end":return e.stop()}},e,this,[[1,5]])})),function(e){return a.apply(this,arguments)})},{key:"callKimiDirect",value:(o=(0,l.default)(i.default.mark(function e(t){var n,r,s,o,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(m.config.moonshotApiKey){e.next=1;break}return t.content="Moonshot API key is missing. Please set REACT_APP_MOONSHOT_API_KEY.",this.notify(),e.abrupt("return");case 1:return e.next=2,fetch("https://api.moonshot.cn/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(m.config.moonshotApiKey)},body:JSON.stringify({model:m.config.kimiModel,messages:this.messages.map(function(e){return{role:e.role,content:e.content}}),temperature:.7})});case 2:if((r=e.sent).ok){e.next=4;break}return e.next=3,r.text();case 3:throw s=e.sent,console.error("Kimi API Error:",s),new Error("Kimi API error: ".concat(r.status));case 4:return e.next=5,r.json();case 5:o=e.sent,a=null===(n=o.choices)||void 0===n||null===(n=n[0])||void 0===n||null===(n=n.message)||void 0===n?void 0:n.content,t.content=a||"Kimi returned an empty response.",this.notify();case 6:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"callVercelBackend",value:(s=(0,l.default)(i.default.mark(function e(t){var n,r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,fetch("".concat(m.config.apiBaseUrl,"/api/chat"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:this.messages.filter(function(e){return"system"!==e.role}).map(function(e){return{role:e.role,content:e.content}})})});case 1:if((n=e.sent).ok){e.next=2;break}throw new Error("Chat API error");case 2:return e.next=3,n.json();case 3:r=e.sent,t.content=r.reply||"I am having trouble connecting to my brain. Please try again.",this.notify();case 4:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"notify",value:function(){var e=this;this.handlers.forEach(function(t){return t((0,u.default)(e.messages))})}},{key:"clearHistory",value:function(){this.messages=[this.messages[0]],this.notify()}}]);t.default=new d},87314(e,t,n){var r=n(18772),s=n(66584);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n(16578)),a=r(n(26007)),i=r(n(58361)),l=function(e){if("function"==typeof WeakMap){var t=new WeakMap;new WeakMap}return function(e){if(e&&e.__esModule)return e;var n,r,o={__proto__:null,default:e};if(null===e||"object"!=s(e)&&"function"!=typeof e)return o;if(n=t){if(n.has(e))return n.get(e);n.set(e,o)}for(var a in e)"default"!==a&&{}.hasOwnProperty.call(e,a)&&((r=(n=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,a))&&(r.get||r.set)?n(o,a,r):o[a]=e[a]);return o}(e)}(n(25602)),u=n(71582),c=n(18878),f=r(n(47864)),m=n(46586),d=n(59354),p=this,h="C:\\Users\\Steve\\OneDrive\\Desktop\\Github Repos\\spark-adhd\\src\\screens\\ChatScreen.tsx";t.default=function(){var e=(0,l.useState)([]),t=(0,i.default)(e,2),n=t[0],r=t[1],s=(0,l.useState)(""),b=(0,i.default)(s,2),g=b[0],y=b[1],k=(0,l.useRef)(null),_=(0,d.useTheme)().isCosmic;(0,l.useEffect)(function(){return f.default.subscribe(function(e){r(e.filter(function(e){return"system"!==e.role}))})},[]),(0,l.useEffect)(function(){setTimeout(function(){var e;null===(e=k.current)||void 0===e||e.scrollToEnd({animated:!0})},100)},[n]);var T,v=(T=(0,a.default)(o.default.mark(function e(){var t;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(g.trim()){e.next=1;break}return e.abrupt("return");case 1:return t=g,y(""),e.next=2,f.default.sendMessage(t);case 2:case"end":return e.stop()}},e)})),function(){return T.apply(this,arguments)}),x=function(e){return u.StyleSheet.create({container:{flex:1},header:{padding:m.Tokens.spacing[4],alignItems:"center",borderBottomWidth:1,borderBottomColor:e?"rgba(139, 92, 246, 0.2)":m.Tokens.colors.neutral.borderSubtle},title:{fontFamily:m.Tokens.type.fontFamily.mono,fontSize:m.Tokens.type.sm,fontWeight:"700",color:e?"#8B5CF6":m.Tokens.colors.brand[500],letterSpacing:2},messageList:{flex:1},messageContent:{padding:m.Tokens.spacing[4],paddingBottom:m.Tokens.spacing[8]},messageRow:{marginBottom:m.Tokens.spacing[4],maxWidth:"85%"},userRow:{alignSelf:"flex-end"},assistantRow:{alignSelf:"flex-start"},bubble:{borderRadius:12},userBubble:{backgroundColor:e?"rgba(139, 92, 246, 0.2)":m.Tokens.colors.brand[900],borderBottomRightRadius:2},assistantBubble:{backgroundColor:e?"#0B1022":m.Tokens.colors.neutral.darker,borderBottomLeftRadius:2},messageText:{fontFamily:m.Tokens.type.fontFamily.sans,fontSize:m.Tokens.type.sm,color:e?"#EEF2FF":m.Tokens.colors.text.primary,lineHeight:20},emptyContainer:{paddingVertical:100,alignItems:"center"},emptyText:{fontFamily:m.Tokens.type.fontFamily.mono,fontSize:m.Tokens.type.xs,color:e?"#B9C2D9":m.Tokens.colors.text.tertiary,opacity:.5},inputArea:{flexDirection:"row",alignItems:"flex-end",padding:m.Tokens.spacing[4],backgroundColor:e?"rgba(7, 7, 18, 0.9)":m.Tokens.colors.neutral.darkest,borderTopWidth:1,borderTopColor:e?"rgba(139, 92, 246, 0.2)":m.Tokens.colors.neutral.borderSubtle,gap:m.Tokens.spacing[3]},input:{flex:1,minHeight:44,maxHeight:120,backgroundColor:e?"rgba(11, 16, 34, 0.8)":m.Tokens.colors.neutral.darker,borderRadius:22,paddingHorizontal:m.Tokens.spacing[4],paddingVertical:m.Tokens.spacing[3],color:e?"#EEF2FF":m.Tokens.colors.text.primary,fontFamily:m.Tokens.type.fontFamily.sans,fontSize:m.Tokens.type.sm}})}(_);return l.default.createElement(c.CosmicBackground,{variant:"nebula",__self:p,__source:{fileName:h,lineNumber:46,columnNumber:5}},l.default.createElement(u.KeyboardAvoidingView,{behavior:"ios"===u.Platform.OS?"padding":void 0,style:x.container,keyboardVerticalOffset:"ios"===u.Platform.OS?90:0,__self:p,__source:{fileName:h,lineNumber:47,columnNumber:7}},l.default.createElement(u.View,{style:x.header,__self:p,__source:{fileName:h,lineNumber:52,columnNumber:9}},l.default.createElement(u.Text,{style:x.title,__self:p,__source:{fileName:h,lineNumber:53,columnNumber:11}},"SPARK_ASSISTANT")),l.default.createElement(u.ScrollView,{ref:k,style:x.messageList,contentContainerStyle:x.messageContent,__self:p,__source:{fileName:h,lineNumber:56,columnNumber:9}},n.map(function(e){return l.default.createElement(u.View,{key:e.id,style:[x.messageRow,"user"===e.role?x.userRow:x.assistantRow],__self:p,__source:{fileName:h,lineNumber:62,columnNumber:13}},l.default.createElement(c.GlowCard,{glow:"assistant"===e.role?"soft":"none",padding:"sm",style:[x.bubble,"user"===e.role?x.userBubble:x.assistantBubble],__self:p,__source:{fileName:h,lineNumber:69,columnNumber:15}},l.default.createElement(u.Text,{style:x.messageText,__self:p,__source:{fileName:h,lineNumber:79,columnNumber:17}},e.content)))}),0===n.length&&l.default.createElement(u.View,{style:x.emptyContainer,__self:p,__source:{fileName:h,lineNumber:84,columnNumber:13}},l.default.createElement(u.Text,{style:x.emptyText,__self:p,__source:{fileName:h,lineNumber:85,columnNumber:15}},"HOW CAN I HELP YOU FOCUS TODAY?"))),l.default.createElement(u.View,{style:x.inputArea,__self:p,__source:{fileName:h,lineNumber:92,columnNumber:9}},l.default.createElement(u.TextInput,{style:x.input,placeholder:"TYPE_YOUR_THOUGHTS...",placeholderTextColor:m.Tokens.colors.text.placeholder,value:g,onChangeText:y,onSubmitEditing:v,multiline:!0,__self:p,__source:{fileName:h,lineNumber:93,columnNumber:11}}),l.default.createElement(c.RuneButton,{variant:"primary",size:"sm",onPress:v,disabled:!g.trim(),__self:p,__source:{fileName:h,lineNumber:102,columnNumber:11}},"SEND"))))}}}]);