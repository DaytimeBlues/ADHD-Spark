(self.webpackChunkspark_adhd_rn=self.webpackChunkspark_adhd_rn||[]).push([[222],{86222(e,t,a){var n=a(18772),r=a(66584);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(a(16578)),l=n(a(26007)),s=n(a(66584)),u=n(a(58361)),i=function(e){if("function"==typeof WeakMap){var t=new WeakMap;new WeakMap}return function(e){if(e&&e.__esModule)return e;var a,n,o={__proto__:null,default:e};if(null===e||"object"!=r(e)&&"function"!=typeof e)return o;if(a=t){if(a.has(e))return a.get(e);a.set(e,o)}for(var l in e)"default"!==l&&{}.hasOwnProperty.call(e,l)&&((n=(a=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,l))&&(n.get||n.set)?a(o,l,n):o[l]=e[l]);return o}(e)}(a(25602)),c=a(71582),m=a(46586),f=a(8747),p=n(a(40629)),d=this,b="C:\\Users\\Steve\\OneDrive\\Desktop\\Github Repos\\spark-adhd-backup\\src\\screens\\DiagnosticsScreen.tsx",k="spark-backup-v1",g="spark-adhd",_=c.StyleSheet.create({safeArea:{flex:1,backgroundColor:m.Tokens.colors.neutral.darkest},container:{flex:1,backgroundColor:m.Tokens.colors.neutral.darkest},header:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingHorizontal:m.Tokens.spacing.md,paddingVertical:m.Tokens.spacing.sm,borderBottomWidth:1,borderBottomColor:m.Tokens.colors.neutral.border},backButton:{paddingVertical:m.Tokens.spacing.xs,paddingHorizontal:m.Tokens.spacing.sm},backButtonText:{fontFamily:m.Tokens.type.fontFamily.mono,fontSize:12,fontWeight:"700",color:m.Tokens.colors.indigo.primary,letterSpacing:.5},title:{fontFamily:m.Tokens.type.fontFamily.mono,fontSize:14,fontWeight:"700",color:m.Tokens.colors.text.primary,letterSpacing:1},refreshButton:{paddingVertical:m.Tokens.spacing.xs,paddingHorizontal:m.Tokens.spacing.sm},refreshButtonText:{fontFamily:m.Tokens.type.fontFamily.mono,fontSize:16,fontWeight:"700",color:m.Tokens.colors.indigo.primary},refreshButtonTextDisabled:{color:m.Tokens.colors.text.tertiary},scrollView:{flex:1},scrollContent:{padding:m.Tokens.spacing.md},section:{marginBottom:m.Tokens.spacing.lg},sectionTitle:{fontFamily:m.Tokens.type.fontFamily.mono,fontSize:10,fontWeight:"700",color:m.Tokens.colors.text.secondary,letterSpacing:1,marginBottom:m.Tokens.spacing.sm},diagRow:{flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start",paddingVertical:m.Tokens.spacing.sm,borderBottomWidth:1,borderBottomColor:m.Tokens.colors.neutral.borderSubtle},diagLabelContainer:{flexDirection:"row",alignItems:"center",flex:1},diagIndicator:{fontFamily:m.Tokens.type.fontFamily.mono,fontSize:12,marginRight:m.Tokens.spacing.xs,width:16},diagLabel:{fontFamily:m.Tokens.type.fontFamily.sans,fontSize:13,color:m.Tokens.colors.text.primary,flex:1},diagValue:{fontFamily:m.Tokens.type.fontFamily.mono,fontSize:11,textAlign:"right",maxWidth:"50%"},instructionText:{fontFamily:m.Tokens.type.fontFamily.sans,fontSize:13,color:m.Tokens.colors.text.secondary,marginBottom:m.Tokens.spacing.sm,lineHeight:20},instructionStep:{fontFamily:m.Tokens.type.fontFamily.mono,fontSize:11,color:m.Tokens.colors.text.primary,marginBottom:m.Tokens.spacing.xs,paddingLeft:m.Tokens.spacing.sm,lineHeight:18},backupActionsRow:{flexDirection:"row",gap:m.Tokens.spacing.sm,marginBottom:m.Tokens.spacing.sm},backupButton:{flex:1,minHeight:m.Tokens.layout.minTapTarget,borderWidth:1,borderColor:m.Tokens.colors.neutral.border,backgroundColor:m.Tokens.colors.neutral.dark,alignItems:"center",justifyContent:"center",paddingVertical:m.Tokens.spacing.xs,paddingHorizontal:m.Tokens.spacing.sm},backupButtonDisabled:{opacity:.5},backupButtonText:{fontFamily:m.Tokens.type.fontFamily.mono,fontSize:m.Tokens.type.xs,color:m.Tokens.colors.text.primary,fontWeight:"700",letterSpacing:1},backupInput:{minHeight:4*m.Tokens.layout.minTapTargetComfortable,borderWidth:1,borderColor:m.Tokens.colors.neutral.border,backgroundColor:m.Tokens.colors.neutral.darker,color:m.Tokens.colors.text.primary,fontFamily:m.Tokens.type.fontFamily.mono,fontSize:m.Tokens.type.xs,padding:m.Tokens.spacing.sm},backupStatusText:{marginTop:m.Tokens.spacing.sm,fontFamily:m.Tokens.type.fontFamily.mono,fontSize:m.Tokens.type.xs,color:m.Tokens.colors.text.secondary},backupMetaText:{fontFamily:m.Tokens.type.fontFamily.mono,fontSize:m.Tokens.type.xs,color:m.Tokens.colors.text.tertiary,marginBottom:m.Tokens.spacing.sm,letterSpacing:.5}});t.default=function(e){var t,n,r,y=e.navigation,T=(0,i.useState)([]),N=(0,u.default)(T,2),x=N[0],h=N[1],S=(0,i.useState)(!1),v=(0,u.default)(S,2),E=v[0],w=v[1],C=(0,i.useState)(""),O=(0,u.default)(C,2),A=O[0],B=O[1],I=(0,i.useState)(!1),D=(0,u.default)(I,2),F=D[0],G=D[1],P=(0,i.useState)(""),R=(0,u.default)(P,2),L=R[0],V=R[1],z=(0,i.useState)(null),j=(0,u.default)(z,2),W=j[0],M=j[1],J=Object.values(p.default.STORAGE_KEYS),U=function(e){V(e),c.AccessibilityInfo.announceForAccessibility(e)},H=function(e){if(!e||"object"!==(0,s.default)(e))return{error:"Backup JSON must be an object."};var t=e;return t.schema!==k?{error:"Unsupported backup schema."}:t.app!==g?{error:"Backup is not from Spark ADHD."}:"string"!=typeof t.exportedAt||Number.isNaN(Date.parse(t.exportedAt))?{error:"Backup exportedAt timestamp is invalid."}:t.data&&"object"===(0,s.default)(t.data)?Object.keys(t.data).some(function(e){return!J.includes(e)})?{error:"Backup data includes unsupported keys."}:Object.values(t.data).some(function(e){return null!==e&&"string"!=typeof e})?{error:"Backup data values must be string or null."}:{payload:t}:{error:"Backup data payload is missing."}},K=(0,i.useCallback)((0,l.default)(o.default.mark(function e(){var t;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,p.default.get(p.default.STORAGE_KEYS.backupLastExportAt);case 1:t=e.sent,M(t);case 2:case"end":return e.stop()}},e)})),[]),Y=(t=(0,l.default)(o.default.mark(function e(t){var a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return G(!0),e.prev=1,e.next=2,Promise.all(J.map(function(){var e=(0,l.default)(o.default.mark(function e(a){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof(n=t.data[a])){e.next=2;break}return e.next=1,p.default.set(a,n);case 1:e.next=3;break;case 2:return e.next=3,p.default.remove(a);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 2:return U("Import completed. Diagnostics reloading..."),e.next=3,Q();case 3:e.next=5;break;case 4:e.prev=4,a=e.catch(1),U(a instanceof Error?a.message:"Import failed unexpectedly.");case 5:return e.prev=5,G(!1),e.finish(5);case 6:case"end":return e.stop()}},e,null,[[1,4,5,6]])})),function(e){return t.apply(this,arguments)}),X=(n=(0,l.default)(o.default.mark(function e(){var t,a,n,r,s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return G(!0),e.prev=1,e.next=2,Promise.all(J.map(function(){var e=(0,l.default)(o.default.mark(function e(t){var a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,p.default.get(t);case 1:return a=e.sent,e.abrupt("return",[t,a]);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 2:return t=e.sent,a={schema:k,exportedAt:(new Date).toISOString(),app:g,data:Object.fromEntries(t)},n=JSON.stringify(a,null,2),B(n),e.next=3,p.default.set(p.default.STORAGE_KEYS.backupLastExportAt,a.exportedAt);case 3:if(M(a.exportedAt),null==(r=c.NativeModules.Clipboard)||!r.setString){e.next=4;break}r.setString(n),U("Backup exported and copied to clipboard."),e.next=6;break;case 4:return e.next=5,c.Share.share({title:"Spark backup JSON",message:n});case 5:U("Backup exported. Shared via system dialog.");case 6:e.next=8;break;case 7:e.prev=7,s=e.catch(1),U(s instanceof Error?s.message:"Export failed unexpectedly.");case 8:return e.prev=8,G(!1),e.finish(8);case 9:case"end":return e.stop()}},e,null,[[1,7,8,9]])})),function(){return n.apply(this,arguments)}),q=(r=(0,l.default)(o.default.mark(function e(){var t,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(A.trim()){e.next=1;break}return U("Paste backup JSON before importing."),e.abrupt("return");case 1:e.prev=1,t=JSON.parse(A),e.next=3;break;case 2:return e.prev=2,e.catch(1),U("Invalid JSON. Import canceled."),e.abrupt("return");case 3:if(!("error"in(a=H(t)))){e.next=4;break}return U("".concat(a.error," Import canceled.")),e.abrupt("return");case 4:if("web"!==c.Platform.OS){e.next=6;break}return e.next=5,Y(a.payload);case 5:return e.abrupt("return");case 6:c.Alert.alert("Import backup?","This overwrites local app data for tracked keys. Continue?",[{text:"Cancel",style:"cancel"},{text:"Import",style:"destructive",onPress:function(){Y(a.payload).catch(function(e){U(e instanceof Error?e.message:"Import failed unexpectedly.")})}}],{cancelable:!0});case 7:case"end":return e.stop()}},e,null,[[1,2]])})),function(){return r.apply(this,arguments)}),Q=(0,i.useCallback)((0,l.default)(o.default.mark(function e(){var t,n,r,l,s,u,i,m,d,b,k,g,_,y,T,N,x;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return w(!0),t=[],e.next=1,K();case 1:if(t.push({label:"Platform",value:c.Platform.OS,status:"info"}),n=Boolean(f.config.googleWebClientId),r=Boolean(f.config.googleIosClientId),l=n||r,t.push({label:"Google Web Client ID",value:n?"Configured":"Missing",status:n?"ok":"warning"}),t.push({label:"Google iOS Client ID",value:r?"Configured":"Missing",status:r?"ok":"warning"}),"web"===c.Platform.OS){e.next=14;break}if(e.prev=2,s=l,t.push({label:"Can Attempt Auth",value:s?"Yes":"No (missing client IDs)",status:s?"ok":"error"}),e.prev=3,null==(u=a(85927))||!u.GoogleSignin){e.next=8;break}return e.prev=4,e.next=5,u.GoogleSignin.getCurrentUser();case 5:null!=(i=e.sent)&&i.scopes?(d=i.scopes.includes("https://www.googleapis.com/auth/tasks"),b=i.scopes.includes("https://www.googleapis.com/auth/calendar.events"),t.push({label:"Google Tasks Scope",value:d?"Granted":"Not granted",status:d?"ok":"warning"}),t.push({label:"Google Calendar Scope",value:b?"Granted":"Not granted",status:b?"ok":"warning"}),t.push({label:"Signed In User",value:(null===(m=i.user)||void 0===m?void 0:m.email)||"Unknown",status:"info"})):t.push({label:"Google Auth Status",value:"Not signed in",status:"warning"}),e.next=7;break;case 6:e.prev=6,e.catch(4),t.push({label:"Google Auth Status",value:"Not signed in",status:"warning"});case 7:e.next=9;break;case 8:t.push({label:"Google Sign-In Module",value:"Not available",status:"error"});case 9:e.next=11;break;case 10:e.prev=10,e.catch(3),t.push({label:"Google Sign-In Module",value:"Not installed",status:"error"});case 11:e.next=13;break;case 12:e.prev=12,x=e.catch(2),t.push({label:"Auth Check Error",value:x instanceof Error?x.message:"Unknown error",status:"error"});case 13:e.next=15;break;case 14:t.push({label:"Google Sync",value:"Not available on web",status:"info"});case 15:return e.prev=15,e.next=16,p.default.get(p.default.STORAGE_KEYS.googleTasksLastSyncAt);case 16:(k=e.sent)?(g=new Date(k),_=new Date,y=Math.floor((_.getTime()-g.getTime())/6e4),t.push({label:"Last Sync",value:"".concat(y," minutes ago (").concat(g.toLocaleString(),")"),status:y<30?"ok":"warning"})):t.push({label:"Last Sync",value:"Never",status:"info"}),e.next=18;break;case 17:e.prev=17,e.catch(15),t.push({label:"Last Sync",value:"Error reading timestamp",status:"error"});case 18:return e.prev=18,e.next=19,p.default.getJSON(p.default.STORAGE_KEYS.googleTasksExportedFingerprints);case 19:T=e.sent,N=Array.isArray(T)?T.length:0,t.push({label:"Exported Items (Dedupe Cache)",value:"".concat(N),status:"info"}),e.next=21;break;case 20:e.prev=20,e.catch(18),t.push({label:"Exported Items",value:"Error reading cache",status:"error"});case 21:h(t),w(!1);case 22:case"end":return e.stop()}},e,null,[[2,12],[3,10],[4,6],[15,17],[18,20]])})),[K]);(0,i.useEffect)(function(){Q()},[Q]);var Z=function(e){switch(e){case"ok":return m.Tokens.colors.success;case"warning":return m.Tokens.colors.warning;case"error":return m.Tokens.colors.error;default:return m.Tokens.colors.text.secondary}};return i.default.createElement(c.SafeAreaView,{style:_.safeArea,__self:d,__source:{fileName:b,lineNumber:439,columnNumber:5}},i.default.createElement(c.View,{style:_.container,__self:d,__source:{fileName:b,lineNumber:440,columnNumber:7}},i.default.createElement(c.View,{style:_.header,__self:d,__source:{fileName:b,lineNumber:442,columnNumber:9}},i.default.createElement(c.TouchableOpacity,{onPress:function(){return y.goBack()},style:_.backButton,accessibilityLabel:"Go back",accessibilityRole:"button",__self:d,__source:{fileName:b,lineNumber:443,columnNumber:11}},i.default.createElement(c.Text,{style:_.backButtonText,__self:d,__source:{fileName:b,lineNumber:449,columnNumber:13}},"← BACK")),i.default.createElement(c.Text,{style:_.title,__self:d,__source:{fileName:b,lineNumber:451,columnNumber:11}},"DIAGNOSTICS"),i.default.createElement(c.TouchableOpacity,{onPress:function(){Q()},style:_.refreshButton,disabled:E,accessibilityLabel:"Refresh diagnostics",accessibilityRole:"button",__self:d,__source:{fileName:b,lineNumber:452,columnNumber:11}},i.default.createElement(c.Text,{style:[_.refreshButtonText,E&&_.refreshButtonTextDisabled],__self:d,__source:{fileName:b,lineNumber:459,columnNumber:13}},E?"...":"↻"))),i.default.createElement(c.ScrollView,{style:_.scrollView,contentContainerStyle:_.scrollContent,__self:d,__source:{fileName:b,lineNumber:471,columnNumber:9}},i.default.createElement(c.View,{style:_.section,__self:d,__source:{fileName:b,lineNumber:475,columnNumber:11}},i.default.createElement(c.Text,{style:_.sectionTitle,__self:d,__source:{fileName:b,lineNumber:476,columnNumber:13}},"SYSTEM STATUS"),x.map(function(e,t){return i.default.createElement(c.View,{key:t,style:_.diagRow,__self:d,__source:{fileName:b,lineNumber:478,columnNumber:15}},i.default.createElement(c.View,{style:_.diagLabelContainer,__self:d,__source:{fileName:b,lineNumber:479,columnNumber:17}},i.default.createElement(c.Text,{style:[_.diagIndicator,{color:Z(e.status)}],__self:d,__source:{fileName:b,lineNumber:480,columnNumber:19}},function(e){switch(e){case"ok":return"✓";case"warning":return"⚠";case"error":return"✗";default:return"●"}}(e.status)),i.default.createElement(c.Text,{style:_.diagLabel,__self:d,__source:{fileName:b,lineNumber:488,columnNumber:19}},e.label)),i.default.createElement(c.Text,{style:[_.diagValue,{color:Z(e.status)}],numberOfLines:2,__self:d,__source:{fileName:b,lineNumber:490,columnNumber:17}},e.value))})),i.default.createElement(c.View,{style:_.section,__self:d,__source:{fileName:b,lineNumber:503,columnNumber:11}},i.default.createElement(c.Text,{style:_.sectionTitle,__self:d,__source:{fileName:b,lineNumber:504,columnNumber:13}},"SETUP INSTRUCTIONS"),i.default.createElement(c.Text,{style:_.instructionText,__self:d,__source:{fileName:b,lineNumber:505,columnNumber:13}},"To enable Google Tasks/Calendar sync:"),i.default.createElement(c.Text,{style:_.instructionStep,__self:d,__source:{fileName:b,lineNumber:508,columnNumber:13}},"1. Create a Firebase project at console.firebase.google.com"),i.default.createElement(c.Text,{style:_.instructionStep,__self:d,__source:{fileName:b,lineNumber:511,columnNumber:13}},"2. Add Android app with package ID: com.sparkadhd"),i.default.createElement(c.Text,{style:_.instructionStep,__self:d,__source:{fileName:b,lineNumber:514,columnNumber:13}},"3. Download google-services.json to android/app/"),i.default.createElement(c.Text,{style:_.instructionStep,__self:d,__source:{fileName:b,lineNumber:517,columnNumber:13}},"4. Enable Google Tasks API in Google Cloud Console"),i.default.createElement(c.Text,{style:_.instructionStep,__self:d,__source:{fileName:b,lineNumber:520,columnNumber:13}},"5. Set REACT_APP_GOOGLE_WEB_CLIENT_ID environment variable"),i.default.createElement(c.Text,{style:_.instructionStep,__self:d,__source:{fileName:b,lineNumber:523,columnNumber:13}},"6. Rebuild the app")),i.default.createElement(c.View,{style:_.section,__self:d,__source:{fileName:b,lineNumber:526,columnNumber:11}},i.default.createElement(c.Text,{style:_.sectionTitle,__self:d,__source:{fileName:b,lineNumber:527,columnNumber:13}},"DATA BACKUP"),i.default.createElement(c.Text,{style:_.instructionText,__self:d,__source:{fileName:b,lineNumber:528,columnNumber:13}},"Export local data as JSON and import it later to restore this device state."),i.default.createElement(c.Text,{style:_.backupMetaText,__self:d,__source:{fileName:b,lineNumber:532,columnNumber:13}},"LAST EXPORT:"," ",W?new Date(W).toLocaleString():"NEVER"),i.default.createElement(c.View,{style:_.backupActionsRow,__self:d,__source:{fileName:b,lineNumber:539,columnNumber:13}},i.default.createElement(c.TouchableOpacity,{testID:"diagnostics-export-backup",onPress:X,disabled:F,style:[_.backupButton,F&&_.backupButtonDisabled],accessibilityRole:"button",accessibilityLabel:"Export backup JSON",__self:d,__source:{fileName:b,lineNumber:540,columnNumber:15}},i.default.createElement(c.Text,{style:_.backupButtonText,__self:d,__source:{fileName:b,lineNumber:551,columnNumber:17}},"EXPORT JSON")),i.default.createElement(c.TouchableOpacity,{testID:"diagnostics-import-backup",onPress:function(){q().catch(function(e){U(e instanceof Error?e.message:"Import failed unexpectedly.")})},disabled:F||!A.trim(),style:[_.backupButton,(F||!A.trim())&&_.backupButtonDisabled],accessibilityRole:"button",accessibilityLabel:"Import backup JSON",__self:d,__source:{fileName:b,lineNumber:554,columnNumber:15}},i.default.createElement(c.Text,{style:_.backupButtonText,__self:d,__source:{fileName:b,lineNumber:566,columnNumber:17}},"IMPORT JSON"))),i.default.createElement(c.TextInput,{testID:"diagnostics-backup-input",style:_.backupInput,value:A,onChangeText:B,multiline:!0,placeholder:"Paste backup JSON here",placeholderTextColor:m.Tokens.colors.text.placeholder,textAlignVertical:"top",accessibilityLabel:"Backup JSON input",__self:d,__source:{fileName:b,lineNumber:570,columnNumber:13}}),L?i.default.createElement(c.Text,{style:_.backupStatusText,__self:d,__source:{fileName:b,lineNumber:583,columnNumber:15}},L):null))))}}}]);