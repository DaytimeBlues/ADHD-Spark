(self.webpackChunkspark_adhd_rn=self.webpackChunkspark_adhd_rn||[]).push([[222],{86222(e,t,n){var a=n(18772),r=n(66584);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n(16578)),l=a(n(26007)),s=a(n(66584)),i=a(n(58361)),u=function(e){if("function"==typeof WeakMap){var t=new WeakMap;new WeakMap}return function(e){if(e&&e.__esModule)return e;var n,a,o={__proto__:null,default:e};if(null===e||"object"!=r(e)&&"function"!=typeof e)return o;if(n=t){if(n.has(e))return n.get(e);n.set(e,o)}for(var l in e)"default"!==l&&{}.hasOwnProperty.call(e,l)&&((a=(n=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,l))&&(a.get||a.set)?n(o,l,a):o[l]=e[l]);return o}(e)}(n(25602)),c=n(71582),m=n(46586),f=n(8747),p=a(n(40629)),d=this,b="C:\\Users\\Steve\\OneDrive\\Desktop\\Github Repos\\spark-adhd-backup\\src\\screens\\DiagnosticsScreen.tsx",g=c.StyleSheet.create({safeArea:{flex:1,backgroundColor:m.Tokens.colors.neutral.darkest},container:{flex:1,backgroundColor:m.Tokens.colors.neutral.darkest},header:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingHorizontal:m.Tokens.spacing.md,paddingVertical:m.Tokens.spacing.sm,borderBottomWidth:1,borderBottomColor:m.Tokens.colors.neutral.border},backButton:{paddingVertical:m.Tokens.spacing.xs,paddingHorizontal:m.Tokens.spacing.sm},backButtonText:{fontFamily:m.Tokens.type.fontFamily.mono,fontSize:12,fontWeight:"700",color:m.Tokens.colors.indigo.primary,letterSpacing:.5},title:{fontFamily:m.Tokens.type.fontFamily.mono,fontSize:14,fontWeight:"700",color:m.Tokens.colors.text.primary,letterSpacing:1},refreshButton:{paddingVertical:m.Tokens.spacing.xs,paddingHorizontal:m.Tokens.spacing.sm},refreshButtonText:{fontFamily:m.Tokens.type.fontFamily.mono,fontSize:16,fontWeight:"700",color:m.Tokens.colors.indigo.primary},refreshButtonTextDisabled:{color:m.Tokens.colors.text.tertiary},scrollView:{flex:1},scrollContent:{padding:m.Tokens.spacing.md},section:{marginBottom:m.Tokens.spacing.lg},sectionTitle:{fontFamily:m.Tokens.type.fontFamily.mono,fontSize:10,fontWeight:"700",color:m.Tokens.colors.text.secondary,letterSpacing:1,marginBottom:m.Tokens.spacing.sm},diagRow:{flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start",paddingVertical:m.Tokens.spacing.sm,borderBottomWidth:1,borderBottomColor:m.Tokens.colors.neutral.borderSubtle},diagLabelContainer:{flexDirection:"row",alignItems:"center",flex:1},diagIndicator:{fontFamily:m.Tokens.type.fontFamily.mono,fontSize:12,marginRight:m.Tokens.spacing.xs,width:16},diagLabel:{fontFamily:m.Tokens.type.fontFamily.sans,fontSize:13,color:m.Tokens.colors.text.primary,flex:1},diagValue:{fontFamily:m.Tokens.type.fontFamily.mono,fontSize:11,textAlign:"right",maxWidth:"50%"},instructionText:{fontFamily:m.Tokens.type.fontFamily.sans,fontSize:13,color:m.Tokens.colors.text.secondary,marginBottom:m.Tokens.spacing.sm,lineHeight:20},instructionStep:{fontFamily:m.Tokens.type.fontFamily.mono,fontSize:11,color:m.Tokens.colors.text.primary,marginBottom:m.Tokens.spacing.xs,paddingLeft:m.Tokens.spacing.sm,lineHeight:18},backupActionsRow:{flexDirection:"row",gap:m.Tokens.spacing.sm,marginBottom:m.Tokens.spacing.sm},backupButton:{flex:1,minHeight:m.Tokens.layout.minTapTarget,borderWidth:1,borderColor:m.Tokens.colors.neutral.border,backgroundColor:m.Tokens.colors.neutral.dark,alignItems:"center",justifyContent:"center",paddingVertical:m.Tokens.spacing.xs,paddingHorizontal:m.Tokens.spacing.sm},backupButtonDisabled:{opacity:.5},backupButtonText:{fontFamily:m.Tokens.type.fontFamily.mono,fontSize:m.Tokens.type.xs,color:m.Tokens.colors.text.primary,fontWeight:"700",letterSpacing:1},backupInput:{minHeight:4*m.Tokens.layout.minTapTargetComfortable,borderWidth:1,borderColor:m.Tokens.colors.neutral.border,backgroundColor:m.Tokens.colors.neutral.darker,color:m.Tokens.colors.text.primary,fontFamily:m.Tokens.type.fontFamily.mono,fontSize:m.Tokens.type.xs,padding:m.Tokens.spacing.sm},backupStatusText:{marginTop:m.Tokens.spacing.sm,fontFamily:m.Tokens.type.fontFamily.mono,fontSize:m.Tokens.type.xs,color:m.Tokens.colors.text.secondary}});t.default=function(e){var t,a,r,k,_=e.navigation,y=(0,u.useState)([]),T=(0,i.default)(y,2),N=T[0],x=T[1],h=(0,u.useState)(!1),S=(0,i.default)(h,2),v=S[0],w=S[1],E=(0,u.useState)(""),C=(0,i.default)(E,2),I=C[0],O=C[1],B=(0,u.useState)(!1),A=(0,i.default)(B,2),D=A[0],F=A[1],G=(0,u.useState)(""),P=(0,i.default)(G,2),V=P[0],R=P[1],L=Object.values(p.default.STORAGE_KEYS),z=function(e){R(e),c.AccessibilityInfo.announceForAccessibility(e)},W=function(e){if(!e||"object"!==(0,s.default)(e))return!1;var t=e;return"spark-backup-v1"===t.schema&&!(!t.data||"object"!==(0,s.default)(t.data))&&Object.keys(t.data).every(function(e){return L.includes(e)})},j=(t=(0,l.default)(o.default.mark(function e(t){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return F(!0),e.prev=1,e.next=2,Promise.all(L.map(function(){var e=(0,l.default)(o.default.mark(function e(n){var a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof(a=t.data[n])){e.next=2;break}return e.next=1,p.default.set(n,a);case 1:e.next=3;break;case 2:return e.next=3,p.default.remove(n);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 2:return z("Import completed. Diagnostics reloading..."),e.next=3,U();case 3:e.next=5;break;case 4:e.prev=4,n=e.catch(1),z(n instanceof Error?n.message:"Import failed unexpectedly.");case 5:return e.prev=5,F(!1),e.finish(5);case 6:case"end":return e.stop()}},e,null,[[1,4,5,6]])})),function(e){return t.apply(this,arguments)}),J=(a=(0,l.default)(o.default.mark(function e(){var t,n,a,r,s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return F(!0),e.prev=1,e.next=2,Promise.all(L.map(function(){var e=(0,l.default)(o.default.mark(function e(t){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,p.default.get(t);case 1:return n=e.sent,e.abrupt("return",[t,n]);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 2:if(t=e.sent,n={schema:"spark-backup-v1",exportedAt:(new Date).toISOString(),app:"spark-adhd",data:Object.fromEntries(t)},a=JSON.stringify(n,null,2),O(a),null==(r=c.NativeModules.Clipboard)||!r.setString){e.next=3;break}r.setString(a),z("Backup exported and copied to clipboard."),e.next=5;break;case 3:return e.next=4,c.Share.share({title:"Spark backup JSON",message:a});case 4:z("Backup exported. Shared via system dialog.");case 5:e.next=7;break;case 6:e.prev=6,s=e.catch(1),z(s instanceof Error?s.message:"Export failed unexpectedly.");case 7:return e.prev=7,F(!1),e.finish(7);case 8:case"end":return e.stop()}},e,null,[[1,6,7,8]])})),function(){return a.apply(this,arguments)}),M=(r=(0,l.default)(o.default.mark(function e(){var t;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(I.trim()){e.next=1;break}return z("Paste backup JSON before importing."),e.abrupt("return");case 1:e.prev=1,t=JSON.parse(I),e.next=3;break;case 2:return e.prev=2,e.catch(1),z("Invalid JSON. Import canceled."),e.abrupt("return");case 3:if(W(t)){e.next=4;break}return z("Unsupported backup schema or keys. Import canceled."),e.abrupt("return");case 4:if("web"!==c.Platform.OS){e.next=6;break}return e.next=5,j(t);case 5:return e.abrupt("return");case 6:c.Alert.alert("Import backup?","This overwrites local app data for tracked keys. Continue?",[{text:"Cancel",style:"cancel"},{text:"Import",style:"destructive",onPress:function(){j(t).catch(function(e){z(e instanceof Error?e.message:"Import failed unexpectedly.")})}}],{cancelable:!0});case 7:case"end":return e.stop()}},e,null,[[1,2]])})),function(){return r.apply(this,arguments)}),U=(k=(0,l.default)(o.default.mark(function e(){var t,a,r,l,s,i,u,m,d,b,g,k,_,y,T,N,h;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(w(!0),(t=[]).push({label:"Platform",value:c.Platform.OS,status:"info"}),a=Boolean(f.config.googleWebClientId),r=Boolean(f.config.googleIosClientId),l=a||r,t.push({label:"Google Web Client ID",value:a?"Configured":"Missing",status:a?"ok":"warning"}),t.push({label:"Google iOS Client ID",value:r?"Configured":"Missing",status:r?"ok":"warning"}),"web"===c.Platform.OS){e.next=13;break}if(e.prev=1,s=l,t.push({label:"Can Attempt Auth",value:s?"Yes":"No (missing client IDs)",status:s?"ok":"error"}),e.prev=2,null==(i=n(85927))||!i.GoogleSignin){e.next=7;break}return e.prev=3,e.next=4,i.GoogleSignin.getCurrentUser();case 4:null!=(u=e.sent)&&u.scopes?(d=u.scopes.includes("https://www.googleapis.com/auth/tasks"),b=u.scopes.includes("https://www.googleapis.com/auth/calendar.events"),t.push({label:"Google Tasks Scope",value:d?"Granted":"Not granted",status:d?"ok":"warning"}),t.push({label:"Google Calendar Scope",value:b?"Granted":"Not granted",status:b?"ok":"warning"}),t.push({label:"Signed In User",value:(null===(m=u.user)||void 0===m?void 0:m.email)||"Unknown",status:"info"})):t.push({label:"Google Auth Status",value:"Not signed in",status:"warning"}),e.next=6;break;case 5:e.prev=5,e.catch(3),t.push({label:"Google Auth Status",value:"Not signed in",status:"warning"});case 6:e.next=8;break;case 7:t.push({label:"Google Sign-In Module",value:"Not available",status:"error"});case 8:e.next=10;break;case 9:e.prev=9,e.catch(2),t.push({label:"Google Sign-In Module",value:"Not installed",status:"error"});case 10:e.next=12;break;case 11:e.prev=11,h=e.catch(1),t.push({label:"Auth Check Error",value:h instanceof Error?h.message:"Unknown error",status:"error"});case 12:e.next=14;break;case 13:t.push({label:"Google Sync",value:"Not available on web",status:"info"});case 14:return e.prev=14,e.next=15,p.default.get(p.default.STORAGE_KEYS.googleTasksLastSyncAt);case 15:(g=e.sent)?(k=new Date(g),_=new Date,y=Math.floor((_.getTime()-k.getTime())/6e4),t.push({label:"Last Sync",value:"".concat(y," minutes ago (").concat(k.toLocaleString(),")"),status:y<30?"ok":"warning"})):t.push({label:"Last Sync",value:"Never",status:"info"}),e.next=17;break;case 16:e.prev=16,e.catch(14),t.push({label:"Last Sync",value:"Error reading timestamp",status:"error"});case 17:return e.prev=17,e.next=18,p.default.getJSON(p.default.STORAGE_KEYS.googleTasksExportedFingerprints);case 18:T=e.sent,N=Array.isArray(T)?T.length:0,t.push({label:"Exported Items (Dedupe Cache)",value:"".concat(N),status:"info"}),e.next=20;break;case 19:e.prev=19,e.catch(17),t.push({label:"Exported Items",value:"Error reading cache",status:"error"});case 20:x(t),w(!1);case 21:case"end":return e.stop()}},e,null,[[1,11],[2,9],[3,5],[14,16],[17,19]])})),function(){return k.apply(this,arguments)});(0,u.useEffect)(function(){U()},[]);var H=function(e){switch(e){case"ok":return m.Tokens.colors.success;case"warning":return m.Tokens.colors.warning;case"error":return m.Tokens.colors.error;default:return m.Tokens.colors.text.secondary}};return u.default.createElement(c.SafeAreaView,{style:g.safeArea,__self:d,__source:{fileName:b,lineNumber:396,columnNumber:5}},u.default.createElement(c.View,{style:g.container,__self:d,__source:{fileName:b,lineNumber:397,columnNumber:7}},u.default.createElement(c.View,{style:g.header,__self:d,__source:{fileName:b,lineNumber:399,columnNumber:9}},u.default.createElement(c.TouchableOpacity,{onPress:function(){return _.goBack()},style:g.backButton,accessibilityLabel:"Go back",accessibilityRole:"button",__self:d,__source:{fileName:b,lineNumber:400,columnNumber:11}},u.default.createElement(c.Text,{style:g.backButtonText,__self:d,__source:{fileName:b,lineNumber:406,columnNumber:13}},"← BACK")),u.default.createElement(c.Text,{style:g.title,__self:d,__source:{fileName:b,lineNumber:408,columnNumber:11}},"DIAGNOSTICS"),u.default.createElement(c.TouchableOpacity,{onPress:function(){U()},style:g.refreshButton,disabled:v,accessibilityLabel:"Refresh diagnostics",accessibilityRole:"button",__self:d,__source:{fileName:b,lineNumber:409,columnNumber:11}},u.default.createElement(c.Text,{style:[g.refreshButtonText,v&&g.refreshButtonTextDisabled],__self:d,__source:{fileName:b,lineNumber:416,columnNumber:13}},v?"...":"↻"))),u.default.createElement(c.ScrollView,{style:g.scrollView,contentContainerStyle:g.scrollContent,__self:d,__source:{fileName:b,lineNumber:428,columnNumber:9}},u.default.createElement(c.View,{style:g.section,__self:d,__source:{fileName:b,lineNumber:432,columnNumber:11}},u.default.createElement(c.Text,{style:g.sectionTitle,__self:d,__source:{fileName:b,lineNumber:433,columnNumber:13}},"SYSTEM STATUS"),N.map(function(e,t){return u.default.createElement(c.View,{key:t,style:g.diagRow,__self:d,__source:{fileName:b,lineNumber:435,columnNumber:15}},u.default.createElement(c.View,{style:g.diagLabelContainer,__self:d,__source:{fileName:b,lineNumber:436,columnNumber:17}},u.default.createElement(c.Text,{style:[g.diagIndicator,{color:H(e.status)}],__self:d,__source:{fileName:b,lineNumber:437,columnNumber:19}},function(e){switch(e){case"ok":return"✓";case"warning":return"⚠";case"error":return"✗";default:return"●"}}(e.status)),u.default.createElement(c.Text,{style:g.diagLabel,__self:d,__source:{fileName:b,lineNumber:445,columnNumber:19}},e.label)),u.default.createElement(c.Text,{style:[g.diagValue,{color:H(e.status)}],numberOfLines:2,__self:d,__source:{fileName:b,lineNumber:447,columnNumber:17}},e.value))})),u.default.createElement(c.View,{style:g.section,__self:d,__source:{fileName:b,lineNumber:460,columnNumber:11}},u.default.createElement(c.Text,{style:g.sectionTitle,__self:d,__source:{fileName:b,lineNumber:461,columnNumber:13}},"SETUP INSTRUCTIONS"),u.default.createElement(c.Text,{style:g.instructionText,__self:d,__source:{fileName:b,lineNumber:462,columnNumber:13}},"To enable Google Tasks/Calendar sync:"),u.default.createElement(c.Text,{style:g.instructionStep,__self:d,__source:{fileName:b,lineNumber:465,columnNumber:13}},"1. Create a Firebase project at console.firebase.google.com"),u.default.createElement(c.Text,{style:g.instructionStep,__self:d,__source:{fileName:b,lineNumber:468,columnNumber:13}},"2. Add Android app with package ID: com.sparkadhd"),u.default.createElement(c.Text,{style:g.instructionStep,__self:d,__source:{fileName:b,lineNumber:471,columnNumber:13}},"3. Download google-services.json to android/app/"),u.default.createElement(c.Text,{style:g.instructionStep,__self:d,__source:{fileName:b,lineNumber:474,columnNumber:13}},"4. Enable Google Tasks API in Google Cloud Console"),u.default.createElement(c.Text,{style:g.instructionStep,__self:d,__source:{fileName:b,lineNumber:477,columnNumber:13}},"5. Set REACT_APP_GOOGLE_WEB_CLIENT_ID environment variable"),u.default.createElement(c.Text,{style:g.instructionStep,__self:d,__source:{fileName:b,lineNumber:480,columnNumber:13}},"6. Rebuild the app")),u.default.createElement(c.View,{style:g.section,__self:d,__source:{fileName:b,lineNumber:483,columnNumber:11}},u.default.createElement(c.Text,{style:g.sectionTitle,__self:d,__source:{fileName:b,lineNumber:484,columnNumber:13}},"DATA BACKUP"),u.default.createElement(c.Text,{style:g.instructionText,__self:d,__source:{fileName:b,lineNumber:485,columnNumber:13}},"Export local data as JSON and import it later to restore this device state."),u.default.createElement(c.View,{style:g.backupActionsRow,__self:d,__source:{fileName:b,lineNumber:490,columnNumber:13}},u.default.createElement(c.TouchableOpacity,{testID:"diagnostics-export-backup",onPress:J,disabled:D,style:[g.backupButton,D&&g.backupButtonDisabled],accessibilityRole:"button",accessibilityLabel:"Export backup JSON",__self:d,__source:{fileName:b,lineNumber:491,columnNumber:15}},u.default.createElement(c.Text,{style:g.backupButtonText,__self:d,__source:{fileName:b,lineNumber:502,columnNumber:17}},"EXPORT JSON")),u.default.createElement(c.TouchableOpacity,{testID:"diagnostics-import-backup",onPress:function(){M().catch(function(e){z(e instanceof Error?e.message:"Import failed unexpectedly.")})},disabled:D||!I.trim(),style:[g.backupButton,(D||!I.trim())&&g.backupButtonDisabled],accessibilityRole:"button",accessibilityLabel:"Import backup JSON",__self:d,__source:{fileName:b,lineNumber:505,columnNumber:15}},u.default.createElement(c.Text,{style:g.backupButtonText,__self:d,__source:{fileName:b,lineNumber:517,columnNumber:17}},"IMPORT JSON"))),u.default.createElement(c.TextInput,{testID:"diagnostics-backup-input",style:g.backupInput,value:I,onChangeText:O,multiline:!0,placeholder:"Paste backup JSON here",placeholderTextColor:m.Tokens.colors.text.placeholder,textAlignVertical:"top",accessibilityLabel:"Backup JSON input",__self:d,__source:{fileName:b,lineNumber:521,columnNumber:13}}),V?u.default.createElement(c.Text,{style:g.backupStatusText,__self:d,__source:{fileName:b,lineNumber:534,columnNumber:15}},V):null))))}}}]);